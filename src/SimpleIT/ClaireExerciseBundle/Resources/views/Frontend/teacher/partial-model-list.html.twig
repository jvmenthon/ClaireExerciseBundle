<div data-ng-controller="modelController">
<div class="panel-body" data-ng-controller="modelListController">

<accordion>
    <accordion-group class="panel panel-primary">
        <accordion-heading class="panel-heading" style="padding-bottom: 0">
            <div class="col-centered">
                <span class="glyphicon glyphicon-filter"></span>&nbsp;{{ 'filtre.model_exercice'|trans }}&nbsp;<span class="caret"></span>
            </div>
        </accordion-heading>
        <div class="col-centered research">
            <div>
                <h5>{{ 'meta.titre'|trans }}</h5>

                <div class="row">
                    <div class="panel panel-primary"
                         title="{{ 'meta.texte'|trans }}">
                        <br>

                        <div ng-repeat="meta in filters.metadata track by $index">
                            <div class="col-xs-5">
                                <input type="text" ng-model="meta.key" class="form-control" disabled>
                            </div>
                            <div class="col-xs-6">
                                <input type="text" ng-model="meta.value" class="form-control" disabled>
                            </div>
                            <div class="col-xs-1"><span data-ng-click="modelRemoveField(filters.metadata, $index)"
                                                        class="glyphicon glyphicon-remove"
                                                        title="{{ 'filtre.supprimer'|trans }}"></span>
                            </div>
                        </div>
                        <div class="">
                            <div class="col-xs-5">
                                <input id="modelAddMetadataKey" type="text" value=""
                                       placeholder="{{ 'meta.cle.placeholder'|trans }}" class="form-control"></div>
                            <div class="col-xs-6">
                                <input id="modelAddMetadataValue" type="text" value=""
                                       placeholder="{{ 'meta.valeur.placeholder'|trans }}" class="form-control"></div>
                            <div class="col-xs-1"><span data-ng-click="modelAddMetadataField(filters.metadata)"
                                                        class="glyphicon glyphicon-ok"
                                                        title="{{ 'filtre.ajouter'|trans }}"></span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div>
                <div class="col-centered">
                    <h5>{{ 'filtre.type'|trans }}</h5>

                    <div class="btn-group">
                        <button class="btn" ng-model="$parent.$parent.filters.type.pair_items" btn-checkbox-true="'pair-items'" btn-checkbox-false="''" btn-checkbox>
                            <span title="{{ 'exercice.type.appariement'|trans }}" class="glyphicon glyphicon-random"></span>
                        </button>
                        <button class="btn" ng-model="$parent.$parent.filters.type.order_items" btn-checkbox-true="'order-items'" btn-checkbox-false="''" btn-checkbox>
                            <span title="{{ 'exercice.type.ordonnacement'|trans }}" class="glyphicon glyphicon-sort"></span>
                        </button>
                        <button class="btn" ng-model="$parent.$parent.filters.type.group_items" btn-checkbox-true="'group-items'" btn-checkbox-false="''" btn-checkbox>
                            <span title="{{ 'exercice.type.roupement'|trans }}" class="glyphicon glyphicon-link"></span>
                        </button>
                        <button class="btn" ng-model="$parent.$parent.filters.type.multiple_choice" btn-checkbox-true="'multiple-choice'" btn-checkbox-false="''" btn-checkbox>
                            <span title="{{ 'exercice.type.qcm'|trans }}" class="glyphicon glyphicon-check"></span>
                        </button>
                        <button class="btn" ng-model="$parent.$parent.filters.type.open_ended_question" btn-checkbox-true="'open-ended-question'" btn-checkbox-false="''" btn-checkbox>
                            <span title="{{ 'exercice.type.qroc'|trans }}" class="glyphicon glyphicon-question-sign"></span>
                        </button>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-centered research">
            <div>
                <h5>{{ 'mots-cle.titre'|trans }}</h5>

                <div class="row"
                     title="{{ 'mots-cle.recherche.titre'|trans }}">
                    <div class="panel panel-primary" title="{{ 'mots-cle.recherche.texte'|trans }}">
                        <br>

                        <div ng-repeat="keyword in filters.keywords track by $index">
                            <div class="col-xs-10">
                                <input type="text" ng-model="keyword" class="form-control" disabled>
                            </div>
                            <div class="col-xs-2"><span data-ng-click="modelRemoveField(filters.keywords, $index)"
                                                        class="glyphicon glyphicon-remove"
                                                        title="{{ 'filtre.supprimer'|trans }}"></span>
                            </div>
                        </div>
                        <div class="col-xs-10"><input id="modelAddKeyword" type="text" value=""
                                                      placeholder="{{ 'mots-cle.ajouter.placeholder'|trans }}" class="form-control">
                        </div>
                        <div class="col-xs-2"><span data-ng-click="modelAddKeywordsField(filters.keywords)"
                                                    class="glyphicon glyphicon-ok"
                                                    title="{{ 'filtre.ajouter'|trans }}"></span>
                        </div>
                    </div>
                </div>
            </div>
            <div>
                <h5>{{ 'recherche.titre'|trans }}</h5>

                <div class="row">
                    <div class="panel panel-primary">
                        <br>

                        <div class="col-xs-10">
                            <input type="text" placeholder="{{ 'recherche.texte'|trans }}" ng-model="$parent.$parent.filters.search"
                                   title="{{ 'recherche.texte'|trans }}">
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </accordion-group>

    <div class="btn-group pull-right" style="margin-left: 4px; margin-top: 4px">
        <label class="btn"
               ng-model="filters.public"
               data-ng-class="{'active': !filters.public, '': filters.public}"
               ng-click="filters.public = !filters.public">{{ 'information.option.prives.titre'|trans }}</label>
        <label class="btn"
               ng-model="filters.public"
               data-ng-class="{'active': filters.public, '': !filters.public}"
               ng-click="filters.public = !filters.public">{{ 'information.option.publics.titre'|trans }}</label>
        <label class="btn"
               data-ng-class="{'active': filters.archived, '': !filters.archived}"
               ng-model="filters.archived"
               ng-click="filters.archived = !filters.archived">{{ 'information.option.archive.titre'|trans }}</label>
    </div>

    <accordion-group class="panel panel-primary">
        <accordion-heading class="panel-heading">
            <div class="col-centered">
                <span class="glyphicon glyphicon-plus"></span>&nbsp;{{ 'model.creer'|trans }}&nbsp;<span class="caret"></span>
            </div>
        </accordion-heading>
        <div class="list-group">
            <div><a href data-ng-click="createModel('pair-items')" class="list-group-item"><span title="Exercice d'appariement" class="glyphicon glyphicon-random"></span>&nbsp;{{ 'exercice.creer.appariement'|trans }}</a></div>
            <div><a href data-ng-click="createModel('order-items')" class="list-group-item"><span title="Exercice d'ordonnancement" class="glyphicon glyphicon-sort"></span>&nbsp;{{ 'exercice.creer.ordonnacement'|trans }}</a></div>
            <div><a href data-ng-click="createModel('group-items')" class="list-group-item"><span title="Exercice de groupement" class="glyphicon glyphicon-link"></span>&nbsp;{{ 'exercice.creer.groupement'|trans }}</a></div>
            <div><a href data-ng-click="createModel('multiple-choice')" class="list-group-item"><span title="QCM" class="glyphicon glyphicon-check"></span>&nbsp;{{ 'exercice.creer.qcm'|trans }}</a></div>
            <div><a href data-ng-click="createModel('open-ended-question')" class="list-group-item"><span title="Question à réponse courte ouverte" class="glyphicon glyphicon-question-sign"></span>&nbsp;{{ 'exercice.creer.qroc'|trans }}</a></div>
        </div>
    </accordion-group>
</accordion>

<accordion close-others="true">
    <!--
        The ng-repeat directive iterates on each item in a collection.
        This collection is dynamically updated by filters. It works basically like unix pipes :)
        Let's explains basically this directive value : << (1: model in models) | (2: filter:filters.search) | (3: myFilters:filters) >>
        Each step are (1,2,3,..) are sequentially processed. Step 1 outputs will be step 2 inputs, and so on.
            1.  Step 1 : The collection contains all models retrieved from the backend. The "models" object must be declared in the modelController scope first.
            2.  Step 2 keeps models that contains as a key or as value the string present in the object filters.search field.
                If this field is empty all models are given to step 3.
            3. Step 3 give the current collection to a custom filtering function.
    -->
    <accordion-group class="panel"
                     ng-repeat="model in models | filter:filters.search | myFilters:filters"
                     data-ng-class="{'panel-primary': model.parent == null, 'panel-model-subscribe': model.parent != null, 'archived': model.archived}">
        <accordion-heading class="panel-heading" style="padding-bottom: 0">
            <div class="row">
                <div class="col-xs-1" ng-switch="model.type">
                    <div ng-switch-when="multiple-choice">
                        <span title="{{ 'exercice.type.qcm'|trans }}" class="glyphicon glyphicon-check" style="font-size: 320%"></span>
                    </div>
                    <div ng-switch-when="open-ended-question">
                        <span title="{{ 'exercice.type.qroc'|trans }}" class="glyphicon glyphicon-question-sign" style="font-size: 320%"></span>
                    </div>
                    <div ng-switch-when="pair-items">
                        <span title="{{ 'exercice.type.appariement'|trans }}" class="glyphicon glyphicon-random" style="font-size: 320%"></span>
                    </div>
                    <div ng-switch-when="order-items">
                        <span title="{{ 'exercice.type.ordonnacement'|trans }}" class="glyphicon glyphicon-sort" style="font-size: 320%"></span>
                    </div>
                    <div ng-switch-when="group-items">
                        <span title="{{ 'exercice.type.groupement'|trans }}" class="glyphicon glyphicon-link" style="font-size: 320%"></span>
                    </div>
                </div>

                <div class="col-xs-11">
                    <div class="col-centered">
                       {{ '{{ model.title }}' }}&nbsp;<span class="caret"></span>
                    </div>
                    <div class="col-centered pull-right">
                        <h4>
                            <span ng-if="model.complete"
                                  ng-click="$event.stopPropagation();tryModel(model)"
                                  class="glyphicon glyphicon-repeat"
                                  title=" {{ 'model.essayer.exercice'|trans }}"></span>
                            <span ng-if="!model.complete"
                                  class="glyphicon glyphicon-repeat"
                                  style="opacity: 0.3"
                                  ng-click="$event.stopPropagation()"
                                  title="{{ 'model.essayer.exercice'|trans }} {{ 'model.essayer.non_complet'|trans }}"></span>
                            &nbsp;
                            <span
                                ng-if="model.owner != BASE_CONFIG.currentUserId || model.parent != null"
                                  ui-sref="modelEdit({ modelid:model.id })"
                                  class="glyphicon glyphicon-eye-open"
                                  title="{{ 'model.voir'|trans }}"></span>
                            <span
                                ng-if="model.owner == BASE_CONFIG.currentUserId && model.parent == null"
                                ui-sref="modelEdit({ modelid:model.id })"
                                class="glyphicon glyphicon-edit"
                                title="{{ 'model.editer'|trans }}"></span>
                            <span
                                ng-if="model.owner == BASE_CONFIG.currentUserId"
                                ng-click="$event.stopPropagation();duplicateModel(model)"
                                class="glyphicon glyphicon-plus"
                                title="{{ 'model.dupliquer'|trans }}"></span>
                            <span
                                ng-if="model.owner !== BASE_CONFIG.currentUserId"
                                ng-click="$event.stopPropagation();importModel(model)"
                                class="glyphicon glyphicon-log-in"
                                title="{{ 'model.importer'|trans }}"></span>
                            <span
                                ng-if="model.owner !== BASE_CONFIG.currentUserId"
                                ng-click="$event.stopPropagation();subscribeModel(model)"
                                class="glyphicon glyphicon-share-alt"
                                title="{{ 'model.abonner'|trans }}"></span>
                            &nbsp;
                            <span
                                ng-if="model.owner == BASE_CONFIG.currentUserId && model.archived"
                                  ng-click="$event.stopPropagation();restoreModel(model)"
                                  class="glyphicon glyphicon-open"
                                  title="{{ 'model.restaurer'|trans }}"></span>
                            <span
                                ng-if="model.owner == BASE_CONFIG.currentUserId && !model.archived"
                                  ng-click="$event.stopPropagation();archiveModel(model)"
                                  class="glyphicon glyphicon-save"
                                  title="{{ 'model.archiver'|trans }}"></span>
                            <span ng-if="model.owner == BASE_CONFIG.currentUserId && model.removable"
                                  ng-click="$event.stopPropagation();deleteModel(model)" class="glyphicon glyphicon-remove"
                                  title="{{ 'model.supprimer.texte'|trans }}"></span>
                            <span ng-if="model.owner == BASE_CONFIG.currentUserId && !model.removable"
                                  class="glyphicon glyphicon-remove"
                                  style="opacity: 0.3"
                                  ng-click="$event.stopPropagation()"
                                  title="{{ 'model.supprimer.utilise'|trans }}"></span>
                        </h4>
                    </div>
                    <div class="row" style="margin-left: 3px">
                        <div style="margin: 1% 1% 0;" class="modelMD">
                            <label class="panel panel-success" data-ng-repeat="meta in model.metadata track by $index" style="margin: 2px;"
                                   title="{{ 'model.meta'|trans }}">
                                &nbsp;<span ui-draggable="true" drag="meta.key">{{ '{{ meta.key }}' }}</span>:&nbsp;<span>{{ '{{ meta.value }}' }}</span>&nbsp;
                            </label>
                            <label class="panel panel-success" data-ng-repeat="keyword in model.keywords track by $index" style="margin: 2px;"
                                   title="{{ 'model.meta'|trans }}">
                                &nbsp;{{ '{{ keyword }}' }}&nbsp;
                            </label>
                        </div>

                    </div>
                </div>
            </div>
        </accordion-heading>
        <div class="col-centered">
            <label>{{ 'information.auteur.titre'|trans }}&nbsp;:&nbsp;</label>{{ '{{  users[model.author].user_name }}' }}
        </div>
        <div class="col-centered">
            <label>{{ 'information.proprietaire.titre'|trans }}&nbsp;:&nbsp;</label>{{ '{{ users[model.owner].user_name }}' }}
        </div>
        <div class="col-centered">
            <label>{{ 'information.option.partage.titre'|trans }}&nbsp;:&nbsp;</label>
            <ng-switch on="model.public">
                <span ng-switch-when="true">{{ 'mot.oui'|trans }}</span>
                <span ng-switch-when="false">{{ 'mot.non'|trans }}</span>
            </ng-switch>
        </div>
        <div class="col-centered">
            <label>{{ 'information.option.complet.titre'|trans }}&nbsp;:&nbsp;</label>
            <ng-switch on="model.complete">
                <span ng-switch-when="true">{{ 'mot.oui'|trans }}</span>
                <span ng-switch-when="false">{{ 'mot.non'|trans }}</span>
            </ng-switch>
        </div>
        <div class="col-centered" ng-switch="model.type">
            <div ng-switch-when="multiple-choice">
                <label>{{ 'model.type'|trans }}Type de modèle&nbsp;:&nbsp;</label>{{ 'exercice.type.qcm'|trans }}QCM
            </div>
            <div ng-switch-when="open-ended-question">
                <label>{{ 'model.typer'|trans }}Type de modèle&nbsp;:&nbsp;</label>{{ 'exercice.type.qroc'|trans }}Question à réponse courte ouverte
            </div>
            <div ng-switch-when="pair-items">
                <label>{{ 'model.type'|trans }}Type de modèle&nbsp;:&nbsp;</label>{{ 'exercice.type.appariement'|trans }}Appariement
            </div>
            <div ng-switch-when="order-items">
                <label>{{ 'model.type'|trans }}Type de modèle&nbsp;:&nbsp;</label>{{ 'exercice.type.ordonnacement'|trans }}Exercice d'ordonnancement
            </div>
            <div ng-switch-when="group-items">
                <label>{{ 'model.type'|trans }}Type de modèle&nbsp;:&nbsp;</label>{{ 'exercice.type.groupement'|trans }}Exercice de groupement
            </div>
        </div>
        <div class="col-centered">
            <label>{{ 'model.consigne'|trans }}&nbsp;:&nbsp;</label>{{ '{{ model.content.wording }}' }}
        </div>
    </accordion-group>
</accordion>

</div>
</div>
